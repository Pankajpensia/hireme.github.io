<!DOCTYPE html>
<html lang="zxx">

<head>
    <!--====== Required meta tags ======-->
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!--====== Title ======-->
    <title>FindMyWork | Dashboard</title>
    <!--====== Favicon Icon ======-->
    <link rel="shortcut icon" href="./images/logo2.png" type="image/png">
    <!--====== Bootstrap css ======-->
    <link rel="stylesheet" href="css/css-bootstrap.min.css">
    <!--====== FontAwesome css ======-->
    <link rel="stylesheet" href="css/css-all.min.css">
    <!--====== Flaticon css ======-->
    <link rel="stylesheet" href="css/flaticon-flaticon.css">
    <!--====== Slick css ======-->
    <link rel="stylesheet" href="css/css-slick.css">
    <!--====== Magnific Popup css ======-->
    <link rel="stylesheet" href="css/css-magnific-popup.css">
    <!--====== jquery ui css ======-->
    <link rel="stylesheet" href="css/css-jquery-ui.min.css">
    <!--====== Nice select css ======-->
    <link rel="stylesheet" href="css/css-nice-select.css">
    <!--====== Animate css ======-->
    <link rel="stylesheet" href="css/css-animate.css">
    <!--====== Megamenu css ======-->
    <link rel="stylesheet" href="css/css-megamenu.css">
    <!--====== Default css ======-->
    <link rel="stylesheet" href="css/css-default.css">
    <!--====== Style css ======-->
    <link rel="stylesheet" href="css/css-style.css">
    <!--====== Responsive css ======-->
    <link rel="stylesheet" href="css/css-responsive.css">
</head>

<body>
    <!--====== Start Preloader ======-->
    <div class="preloader" style="display: none;">
        <div class="lds-ellipsis">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>
    <div class="main-wrapper" id="Login-Page" Style="display:block">
        <div class="user-area-section pt-120 pb-120">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="user-form">
						   <h1 class="text-center">Login As Seller</h1>
                            <form>
                                <div class="form_group">
                                    <label>Mobile Number *</label>
                                    <input type="tel" id="LoginNumber" class="form_control" required="">
                                </div>
                                <div class="form_group">
                                    <label>Password *</label>
                                    <input type="text" id="LoginPassword" class="form_control">
                                </div>
                                <div class="form_checkbox d-flex align-items-center">
                                    <span id="SwichToNewBtn">Don't have any Account <span style="color:red; cursor:pointer;">Create Account</span></span>
                                </div>
                                <div class="form_group">
                                    <button type="button" id="LoginBtn" class="main-btn">Login</button>
                                   </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
		
	<div id="Register-Page" style="display:none;">

    <div class="main-wrapper">
        <div class="user-area-section pt-120 pb-120">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="user-form">
						 <h1 class="text-center">Register As Seller</h1>
                          
                            <form action="#">
                                <div class="form_group">
                                    <label>Username * <small style="color:red;">type Username without any space</small></label>
                                    <input type="text" maxlength="10" id="username" class="form_control">
                                </div>
                                <div class="form_group">
                                    <label>Mobile Number * <small style="color:red;">make sure this is your WhatsApp number</small> <small style="color:green;">OTP less Registration</small></label>
                                    <input type="tel" maxlength="10" class="form_control" id="MobileNumber">
							
                                </div>
                                <div class="form_group">
                                    <label>Password *</label>
                                    <input type="text" id="Password" class="form_control">
                                </div>
                                <div class="form_checkbox d-flex align-items-center">
                                    <span id="SwichToLoginBtn">Already have an Account <span style="color:green; cursor:pointer;"> Login Now </span></span>
                                </div>
                                <div class="form_group">
                                    <button type="button" id="RegistrationBtn" class="main-btn">Create Account</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
</div>
</div>
		<div id="Home-Page" class="main-wrapper" Style="display:none;">
		   <!--====== Start Header ======-->
        <header class="header-area header-one">
            <div class="header-navigation">
                <div class="container-fluid pl-0 pr-0">
                    <div class="row align-items-center">
                        <div class="col-lg-2 col-md-4 col-5">
                            <div class="brand-logo">
                                <a href="index.html"><img src="images/logo1.png" class="img-fluid" alt="Logo"></a>
                            </div>
                        </div>
                        <div class="col-lg-8 col-md-4 col-2">
                            <div class="nav-menu">
                                <!-- navbar-close -->
                                <div class="navbar-close">
                                    <div class="cross-wrap"><span class="top"></span><span class="bottom"></span></div>
                                </div>
                                <!-- Mobile Menu Logo -->
                                <div class="brand-logo text-center ml-2 mr-2 mb-4">
                                    <a href="index.html"><img src="images/logo1.png" class="img-fluid" alt="Logo"></a>
                                </div>
                               
                                <!-- main menu -->
                                 <nav class="main-menu">
                                    <ul>
                                        <li class="menu-item">
                                            <a href="index.html">Home</a>
                                        </li>
                                        <li class="menu-item ">
                                            <a href="services.html">Service</a>
                                           
                                        </li>
                                      
                                      
                                    </ul>
                                </nav>
                            </div>
                        </div>
                        <div class="col-lg-2 col-md-4 col-5">
                            <div class="nav-tools">
                                <ul>
                                    <li>
									  <span id="NavUserName" class="mx-3"></span>
									  <button class="btn btn-primary" id="LogOutBtn">Logout</button>
									<li>
                                    <li class="nav-toggle-btn">
                                        <div class="navbar-toggler">
                                            <span></span><span></span><span></span>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!--====== End Header ======-->
<div class="user-area-section pt-20 pb-20">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="user-form">
						<h2 class="text-center">Create Your Gig</h2>
                            <form action="#">
                                <div class="form_group">
                                    <label>Gig Thumnail *</label>
                                    <input type="file" id="imageInput" class="pt-2 px-2 pb-2">
                                </div>

                                <div class="form_group my-3	">
                                    <label>Gig Title * <small>50 chracters only</small></label>
                                    <input type="text" minlength="10" maxlength="50" id="postTitle" class="form_control">
								
                                </div>
								
                                <div class="form_group my-3	">
                                    <label>Gig Amount * <small></small></label>
                                    <input type="tel" id="postPrice" class="form_control">
								
                                </div>
                                <div class="form_group">
                                    <label>Gig Discription *</label>
                                    <textarea type="password" id="postDiscription" class="form_control"></textarea>
                                </div>
                        
                                <div class="form_group">
                                    <button type="button" id="uploadButton" class="main-btn">Create Gig</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
		
                    <div class="col-lg-9">
                       <div class="row" id="imageContainer">
					   </div>
					         
                    </div>
                
	</div>
	<span class="back-to-top"><i class="far fa-chevron-up"></i></span>

    <!--====== Jquery js ======-->
    <script src="js/js-jquery.min.js"></script>
    <!--====== Bootstrap js ======-->
    <script src="js/js-popper.min.js"></script>
    <script src="js/js-bootstrap.min.js"></script>
    <!--====== Magnific Popup js ======-->
    <script src="js/js-jquery.magnific-popup.min.js"></script>
    <!--====== Nice select ======-->
    <script src="js/js-jquery.nice-select.min.js"></script>
    <!--====== Jquery UI ======-->
    <script src="js/js-jquery-ui.min.js"></script>
    <!--====== Slick js ======-->
    <script src="js/js-slick.min.js"></script>
    <!--====== Main js ======-->
    <script src="js/js-main.js"></script>
	
<!-- Load JavaScript module -->
<script type="module">

document.querySelector("#uploadButton").addEventListener("click", uploadImage);

let username = document.getElementById("username");
let MobileNumber = document.getElementById("MobileNumber");
let Password = document.getElementById("Password");
// Import Firebase SDK modules
import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.0.1/firebase-app.js'; 
import { getStorage, ref, listAll, getDownloadURL, uploadBytes, deleteObject } from 'https://www.gstatic.com/firebasejs/9.0.1/firebase-storage.js';
import { getDatabase, ref as dbRef, push, set, onChildAdded, remove, onValue } from 'https://www.gstatic.com/firebasejs/9.0.1/firebase-database.js';

import {getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.0.1/firebase-auth.js';
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyA9LG1iBZVkmRx2UCJE_CLcBNygw_4wX7k",
  authDomain: "hire-me-6f503.firebaseapp.com",
  databaseURL: "https://hire-me-6f503-default-rtdb.firebaseio.com",
  projectId: "hire-me-6f503",
  storageBucket: "hire-me-6f503.appspot.com",
  messagingSenderId: "468165791374",
  appId: "1:468165791374:web:909c4a28f36330b2c483df",
  measurementId: "G-4M1CK8TBL3"
};
// Assuming 'auth' and 'database' objects are defined elsewhere
//import { getAuth, createUserWithEmailAndPassword } from 'firebase/auth';
//import { getDatabase, ref, push, set } from 'firebase/database';

let HomePage = document.getElementById("Home-Page");
let LoginPage = document.getElementById("Login-Page");
let RegisterPage = document.getElementById("Register-Page");

SwichToLoginBtn.addEventListener("click", function(){
LoginPage.style.display = "block";
RegisterPage.style.display = "none";
})

SwichToNewBtn.addEventListener("click", function(){
LoginPage.style.display = "none";
RegisterPage.style.display = "block";
})


	

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const storage = getStorage(app);
const database = getDatabase(app);
const auth = getAuth();
// Event listener for registration button
document.getElementById('RegistrationBtn').addEventListener('click', async function (e) {
  e.preventDefault();

  const NewUser = document.getElementById('username').value;
  const NewMobile = document.getElementById('MobileNumber').value;
  const newPassword = document.getElementById('Password').value;

  try {
    // Create user with email and password
    const userCredential = await createUserWithEmailAndPassword(
      auth,
      `${NewMobile}@gmail.com`, // Use the provided mobile number with Gmail domain
      newPassword
    );

    // Get the user UID from the userCredential
    const userUid = userCredential.user.uid;

                const userNodeRef = push(dbRef(database, `User/${NewMobile}/`))
    // Set user data under the user node
    await set(userNodeRef, {
      UserName: NewUser,
      UserMobile: NewMobile,
      UserPassword: newPassword,
      UserUid: userUid // Store the UID for future reference
    });

    // Success message
    alert('Registration successful!');
   RegisterPage.style.display = "none";
   LoginPage.style.display = "block";
    // You might want to redirect the user to a different page here

  } catch (error) {
    if (error.code === 'auth/email-already-in-use') {
      alert('Mobile Number is already in use. Please log in to your account.');
    } else {
      console.error('Error during registration:', error);
      alert('User registration failed. Error: ' + error.message);
    }
  }
});

LoginBtn.addEventListener("click", async function (e) {
	e.preventDefault();
	const mobileNumber = document.getElementById("LoginNumber").value
	const password = document.getElementById("LoginPassword").value;
  // let userRef = dbRef(database, `User/${NewMobile}/`);
   
	try {
	var Ref = dbRef(database, `User/${mobileNumber}/`);

onValue(Ref, (snapshot) => {
  snapshot.forEach((childSnapshot) => {
    const userData = childSnapshot.val();
    console.log(userData);
    localStorage.setItem("UserName", userData.UserName);
    localStorage.setItem("UserMobile", userData.UserMobile);
  });
}, (error) => {
  console.error("Error getting data:", error.message);
});
	const userCredential = await signInWithEmailAndPassword(auth, mobileNumber + "@gmail.com", password);
	const user = userCredential.user;
	console.log("Success! Welcome back!");
	alert("Login Successfully");
	LoginPage.style.display = "none";
	HomePage.style.display = "block";
	
	} catch (error) {
	if(error.code === "auth/invalid-email"){
	    alert("Please Check Your Mobile Number");
	}
	if(error.code === "auth/invalid-login-credentials"){
	    alert("Please Check Your Mobile And Password");
	}else{
	 console.log(error);
	}
	}
	
	});

let NavUserName = document.getElementById("NavUserName");
	auth.onAuthStateChanged((user) => {
	if (user) {
	   LoginPage.style.display = "none";
	   NavUserName.innerHTML = "Hi" + " " + localStorage.getItem("UserName");
	   HomePage.style.display = "block";
	}
	else {
	   LoginPage.style.display = "block";
	   HomePage.style.display = "none";
	}
	});	

LogOutBtn.addEventListener("click", function() {
	auth.signOut().then(() => {
	HomePage.style.display = "none";
	LoginPage.style.display = "block";
	localStorage.clear()
	}).catch((error) => {
	console.error("Error during logout:", error);
	});
	});

// Get references to DOM elements
const imageInput = document.getElementById('imageInput');
const imageContainer = document.getElementById('imageContainer');
const PostTitle = document.getElementById("postTitle");
const PostDisc = document.getElementById("postDiscription")
const PostPrice = document.getElementById("postPrice")
// Function to upload image to Firebase Storage and store data in Realtime Database
function uploadImage() {	
    const file = imageInput.files[0];
    if (file) {
        // Create a reference to the file you want to upload
        const storageRef = ref(storage, 'images/' + file.name);

        // Upload file to Firebase Storage
        uploadBytes(storageRef, file).then((snapshot) => {
            console.log('Uploaded a file!');

            // Get download URL for the uploaded image
            getDownloadURL(snapshot.ref).then((downloadURL) => {
                // Store image data in Realtime Database
                const imageId = push(dbRef(database, `Services/${localStorage.getItem("UserMobile")}`)).key;
                const ServiceID = push(dbRef(database, "Services")).key;
                
				const imageData = {
				    User: localStorage.getItem("UserName"),
					Title: postTitle.value,
					Price: PostPrice.value,
                    imageId: imageId,
					imageName: file.name,
					imageURL: downloadURL,
					Contact: localStorage.getItem("UserMobile")
                };
				
				const ServiceData = {
				    User:localStorage.getItem("UserName"),
					Title: postTitle.value,
					Price: PostPrice.value,
                    imageId: imageId,
					imageName: file.name,
					imageURL: downloadURL,
					Contact: localStorage.getItem("UserMobile")
                };

                // Set the image data in the database
                set(dbRef(database, `Services/${localStorage.getItem("UserMobile")}/${imageId}`), imageData);
				set(dbRef(database, "Gigs/" + imageId), imageData);
alert("Gig Uploaded Successfully");
                // Refresh the displayed images
                displayImages();
            }).catch((error) => {
                console.error('Error getting download URL:', error);
            });
        }).catch((error) => {
            console.error('Error uploading file:', error);
        });
    } else {
        console.error('No file selected.');
    }
}

function displayImages() {
    	onValue(dbRef(database, `Services/${localStorage.getItem("UserMobile")}`), (snapshot) => {
	
	snapshot.forEach((childSnapshot) => {
	const imageData = childSnapshot.val();
	   const imgElement = `
	   	  <div class="col-xl-4 col-md-6">
                            <div class="gig-item mb-30" data-image-id="${imageData.imageId}" data-image-name="${imageData.imageName}">
                                <div class="gig-img">
                                    <a href="service-details.html"><img src="${imageData.imageURL}" alt="Image"></a>
                                </div>
                                <div class="gig-info">
                                    <div class="gig-top">
                                        <div class="user-title-thumb">
                                            <div class="user-thumb">
                                                <img class="rounded-circle" src="user.avif" alt="Image">
                                            </div>
                                            <div class="user-info">
                                                <h5 class="name">${imageData.User}</h5>
                                            </div>
                                        </div>
                                        <div class="heart">
                                            <a href="404.html" class="icon"><i class="fas fa-share"></i></a>
                                        </div>
                                    </div>
                                    <div class="service-content">
                                        <h4 class="title"><a href="service-details.html">${imageData.Title}</a></h4>
                                        <div class="rating-info">
                                            <button class="btn btn-danger deleteButton">Delete Service</button>
                                        </div>
                                    </div>
                                    <div class="service-bottom">
                                        <span class="text">Starting at</span>
                                        <span class="nubmer">${imageData.Price}</span>
                                    </div>
                                </div>
                            </div>
							</div>
                        `;

                        imageContainer.innerHTML += imgElement;

                        const deleteButtons = document.querySelectorAll('.deleteButton');
                        deleteButtons.forEach((button) => {
                            button.addEventListener('click', function () {
                                const parentDiv = this.closest('.gig-item');
                                const imageId = parentDiv.getAttribute('data-image-id');
                                const imageName = parentDiv.getAttribute('data-image-name');
                                deleteImages(imageId, imageName);
                            });
                        });
	})
	
	})
	
}
 
function hideDuplicateElementsByClass(className) {
        // Get all elements with the specified class
        var elements = document.getElementsByClassName(className);

        // Create an object to store unique content
        var uniqueContent = {};

        // Iterate through the elements
        for (var i = 0; i < elements.length; i++) {
            var content = elements[i].textContent;

            // Check if the content is already in the uniqueContent object
            if (uniqueContent[content]) {
                // Hide the duplicate element
                elements[i].style.display = 'none';
            } else {
                // Mark the content as seen
                uniqueContent[content] = true;
            }
        }
    }


// Function to delete a specific image by its ID
function deleteImages(imageId, imageName) {
    // Delete the corresponding image data from the Realtime Database
    remove(dbRef(database, `Services/${localStorage.getItem("UserMobile")}/${imageId}`)).then(() => {
        console.log('Deleted the image data from the database!');
        // Refresh the displayed images
        displayImages();
    }).catch((error) => {
        console.error('Error deleting image data from the database:', error);
    });
 remove(dbRef(database, `Gigs/${imageId}`)).then(() => {
        console.log('Deleted the image data from the database!');
    }).catch((error) => {
        console.error('Error deleting image data from the database:', error);
    });
    // Delete the image from Firebase Storage
    const storageRef = ref(storage, 'images/' + imageName);
    deleteObject(storageRef).then(() => {
        console.log('Deleted the file from storage!');
    }).catch((error) => {
        console.error('Error deleting file from storage:', error);
    });
}

displayImages();

</script>

</body>

</html>
